########### Order Manager SQL Queries

order.orderlist=SELECT * FROM EM_USER_MASTER

## Order Master Page
order.portalOrder=select zam.order_id,zam.status_code,zam.retry,zam.sys_creation_date,zam.sys_update_date,zam.originator_id,zeo.order_type,zcb.ban_number,zcb.ctn_number, en.first_name,en.last_name,en.email,en.phone_number,en.address1,en.address2,en.city,en.state,en.zip_code from zig_auto_master zam ,zig_extra_order zeo ,zig_customer_backend_info zcb ,zig_enrollment en where zam.order_id=zeo.order_id AND zeo.order_id=zcb.order_id AND zeo.order_id=en.order_id AND ZAM.ORDER_ID=?
order.ensembleOrder=SELECT A.EXT_ORDER_OID,A.ENS_ORDER_OID,B.BAN,B.SYS_CREATION_DATE, B.SYS_UPDATE_DATE, B.APPLICATION_ID, B.ORDER_STATUS FROM ENS_EXT_ORDER_MAP A,POS_ORDER B WHERE A.ENS_ORDER_OID = B.ORDER_OID  AND A.EXT_ORDER_OID = ?
order.apiOrder=SELECT ORDER_ID,ERROR_MESSAGE,SOURCE,API_NAME,to_char(SYS_CREATION_DATE,'DD-MON-YYYY HH:MI:SS AM') as SYS_CREATION_DATE,ORIGINATOR_ID,SEQ_NUM FROM zig_ser_order_error where order_id=? and rownum<=50  order by sys_creation_date desc
order.getAPIRequest=SELECT REQUEST FROM ZIG_SER_ORDER_ERROR WHERE SEQ_NUM =?
order.getEnrollmentDetails=select en.first_name,en.last_name,en.email,en.phone_number,en.address1,en.address2,en.city,en.state,en.zip_code  from zig_enrollment en  where en.ORDER_ID=?
order.getPortalShipmentDetails=SELECT ORDER_ID,EPC_SKU_ID,PRODUCT_TYPE,ESN_NO,IMEI AS IMEI,SIM,SHIPMENT_DATE,LINE_ITEM_NO, B.DISPLAY_NAME FROM ZIG_ORDER_SHIPMENT_INFO A, DCS_INVENTORY B WHERE A.EPC_SKU_ID = B.CATALOG_REF_ID AND A.ORDER_ID = ?
order.getOrderBANandCTN=select zcb.ban_number,zcb.ctn_number from zig_customer_backend_info zcb where zcb.ORDER_ID=?
order.getOrderType=select zeo.order_type from zig_extra_order zeo where zeo.ORDER_ID=?
order.getPortalOrderDetails=select zam.order_id,zam.status_code,zam.retry,zam.sys_creation_date,zam.sys_update_date,zam.originator_id from zig_auto_master zam where ZAM.ORDER_ID=?
order.getPortalLineItemInfo=SELECT ORDER_ID,LINE_ID,IMEI,SUBSCRIBER_ID,EXISTING_USER_LINE_TYPE,ZIP_CODE,UPDATE_SUB_CALLED,PURCHASE_DEVICE_CALLED,WIRELESS_NUMBER,( CASE  WHEN LI.LINE_TYPE = '100' THEN 'PORTIN' ELSE 'REGULAR' END ) AS LINE_TYPE, ( CASE WHEN li.existing_user_line_type = '300' THEN 'SIM_SWAP'	WHEN li.existing_user_line_type = '200' THEN 'UPGRADE'	WHEN li.existing_user_line_type = '100' THEN 'ADDLINE' ELSE 'NEW_CUST' END ) AS SUB_FLOW_TYPE FROM ZIG_LINEITEM_INFO li WHERE ORDER_ID = ?
order.getEnsLineItemInfo=SELECT POS.ORDER_OID,POS.APPLICATION_ID,POS.SUBLINE_STATUS,POS.PTN,POS.SUBSCRIBER_NO,POS.ICC_ID,POS.IMEI_SIM,SR.BAN,SR.PTN_STATUS FROM POS_ORDER_SUBLINE POS,SUBSCRIBER_RSOURCE SR WHERE POS.SUBSCRIBER_NO = SR.SUBSCRIBER_NO AND POS.ORDER_OID = (SELECT ENS_ORDER_OID FROM ENS_EXT_ORDER_MAP WHERE EXT_ORDER_OID = ?)
order.getPortalPortinDetails=SELECT ORDER_ID,NUMBER_TO_TRANSFER,LINE_ID,PORTIN_STATUS,SPNAME FROM ZIG_PORTIN_INFO WHERE ORDER_ID = ?
order.getEnsPortinDetails=SELECT B.REQUEST_NO,B.BAN,B.PORT_PATH,B.REQUEST_STS,B.EXTERNAL_REQ_NO,C.STATUS_DESC,(SELECT PTN_NO FROM SUB_PORT_REQUEST WHERE REQUEST_NO = A.REQUEST_NO AND ROWNUM=1)AS PTN_NO FROM ORDER_PORT_REQUEST A, PORT_REQUEST B, PORT_STATUS C, ENS_EXT_ORDER_MAP D WHERE A.REQUEST_NO = B.REQUEST_NO AND C.STATUS_CODE = B.REQUEST_STS AND C.PORT_TYPE = B.PORT_PATH AND A.ORDER_OID = D.ENS_ORDER_OID AND D.EXT_ORDER_OID = ?

## Dashboard Page
order.stuckOrdersCount=select status_code ,count(status_code) as count from zig_auto_master where sys_creation_date>sysdate-50 and status_code in ('OSHF','ORFI','ACTF','ORLF','OURF','PDRF','PTRF') group by status_code
order.stuckOrdersbyStatus=select order_id from zig_auto_master where sys_creation_date>sysdate-50 and status_code=?
order.handled=select new_value,count(new_value) as count from PSO_ORDER_TRACKER where sys_update_time > sysdate-10 and new_value in ('OSHF','ORFI','ORLF','ACTF','OURF','PDRF','PRTF') group by new_value
order.stuckOrdersStatusbyCount=select status_code,count(status_code) as count from zig_auto_master where sys_creation_date>sysdate-50 and status_code in ('OSHF','ORFI','ACTF','ORLF','OURF','PDRF','PRTF') group by status_code
order.stuckOrderBacklogInLast10Days=SELECT TO_CHAR(SYS_CREATION_DATE,'DD-MM-YYYY')AS CREATION_DATE,STATUS_CODE,count(ORDER_ID) AS ORDER_COUNT FROM (SELECT ORDER_ID,STATUS_CODE,SYS_CREATION_DATE FROM ZIG_AUTO_MASTER WHERE SYS_CREATION_DATE > SYSDATE-10)GROUP BY TO_CHAR(SYS_CREATION_DATE,'DD-MM-YYYY'),STATUS_CODE ORDER BY TO_CHAR(SYS_CREATION_DATE,'DD-MM-YYYY') DESC

## Update Order Page
order.updateOrderStatusQuerry=update ZIG_AUTO_MASTER set status_code=? where order_id=?
order.updateOrderIMEIQuerry=update ZIG_ORDER_SHIPMENT_INFO set IMEI=? where product_type='sim' and order_id=?
order.updateOrderSIMQuerry=update ZIG_ORDER_SHIPMENT_INFO set SIM=? where product_type='sim' and order_id=?
order.updateOrderRetryCountQuerry=update ZIG_AUTO_MASTER set retry=? where order_id=?
order.updateOrderTrackerQuerry=insert into PSO_ORDER_TRACKER values (?,?,?,sysdate,?,?,?)



