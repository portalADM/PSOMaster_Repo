########### Order Manager SQL Queries

order.orderlist=SELECT * FROM EM_USER_MASTER

## Order Master Page
order.portalOrder=select zam.order_id,zam.status_code,zam.retry,zam.sys_creation_date,zam.sys_update_date,zam.originator_id,zeo.order_type,zcb.ban_number,zcb.ctn_number, en.first_name,en.last_name,en.email,en.phone_number,en.address1,en.address2,en.city,en.state,en.zip_code from zig_auto_master zam ,zig_extra_order zeo ,zig_customer_backend_info zcb ,zig_enrollment en where zam.order_id=zeo.order_id AND zeo.order_id=zcb.order_id AND zeo.order_id=en.order_id AND ZAM.ORDER_ID=?
order.ensembleOrder=SELECT A.EXT_ORDER_OID,A.ENS_ORDER_OID,B.BAN,B.SYS_CREATION_DATE, B.SYS_UPDATE_DATE, B.APPLICATION_ID, B.ORDER_STATUS FROM ENS_EXT_ORDER_MAP A,POS_ORDER B WHERE A.ENS_ORDER_OID = B.ORDER_OID  AND A.EXT_ORDER_OID = ?
order.apiOrder=SELECT ORDER_ID,ERROR_MESSAGE,SOURCE,API_NAME,TO_CHAR(SYS_CREATION_DATE,'DD-MON-YYYY HH:MI:SS AM') AS SYS_CREATION_DATE,ORIGINATOR_ID,SEQ_NUM,(CASE WHEN ERROR_CODE IN ('100','200') THEN 'N' ELSE 'Y' END ) AS HASERROR FROM ZIG_SER_ORDER_ERROR  where order_id=? and rownum<=50  order by sys_creation_date desc
order.getAPIRequest=SELECT REQUEST FROM ZIG_SER_ORDER_ERROR WHERE SEQ_NUM =?
order.getAPIResponse=SELECT RESPONSE FROM ZIG_SER_ORDER_ERROR WHERE SEQ_NUM =?
order.getEnrollmentDetails=select en.first_name,en.last_name,en.email,en.phone_number,en.address1,en.address2,en.city,en.state,en.zip_code  from zig_enrollment en  where en.ORDER_ID=?
order.getPortalShipmentDetails=SELECT ORDER_ID,EPC_SKU_ID,PRODUCT_TYPE,ESN_NO,IMEI AS IMEI,SIM,SHIPMENT_DATE,LINE_ITEM_NO, B.DISPLAY_NAME FROM ZIG_ORDER_SHIPMENT_INFO A, DCS_INVENTORY B WHERE A.EPC_SKU_ID = B.CATALOG_REF_ID AND A.ORDER_ID = ?
order.getOrderBANandCTN=select zcb.ban_number,zcb.ctn_number from zig_customer_backend_info zcb where zcb.ORDER_ID=?
order.getOrderType=select zeo.order_type from zig_extra_order zeo where zeo.ORDER_ID=?
order.getPortalOrderDetails=select zam.order_id,zam.status_code,zam.retry,zam.sys_creation_date,zam.sys_update_date,zam.originator_id from zig_auto_master zam where ZAM.ORDER_ID=?
order.getPortalLineItemInfo=SELECT ORDER_ID,LINE_ID,IMEI,SUBSCRIBER_ID,EXISTING_USER_LINE_TYPE,ZIP_CODE,UPDATE_SUB_CALLED,PURCHASE_DEVICE_CALLED,WIRELESS_NUMBER,( CASE  WHEN LI.LINE_TYPE = '100' THEN 'PORTIN' ELSE 'REGULAR' END ) AS LINE_TYPE, ( CASE WHEN li.existing_user_line_type = '300' THEN 'SIM_SWAP'	WHEN li.existing_user_line_type = '200' THEN 'UPGRADE'	WHEN li.existing_user_line_type = '100' THEN 'ADDLINE' ELSE 'NEW_CUST' END ) AS SUB_FLOW_TYPE FROM ZIG_LINEITEM_INFO li WHERE ORDER_ID = ?
order.getEnsLineItemInfo=SELECT POS.ORDER_OID,POS.APPLICATION_ID,POS.SUBLINE_STATUS,POS.PTN,POS.SUBSCRIBER_NO,POS.ICC_ID,POS.IMEI_SIM,SR.BAN,SR.PTN_STATUS FROM POS_ORDER_SUBLINE POS,SUBSCRIBER_RSOURCE SR WHERE POS.SUBSCRIBER_NO = SR.SUBSCRIBER_NO AND POS.ORDER_OID = (SELECT ENS_ORDER_OID FROM ENS_EXT_ORDER_MAP WHERE EXT_ORDER_OID = ?)
order.getPortalPortinDetails=SELECT ORDER_ID,NUMBER_TO_TRANSFER,LINE_ID,PORTIN_STATUS,SPNAME FROM ZIG_PORTIN_INFO WHERE ORDER_ID = ?
order.getEnsPortinDetails=SELECT B.REQUEST_NO,B.BAN,B.PORT_PATH,B.REQUEST_STS,B.EXTERNAL_REQ_NO,C.STATUS_DESC,(SELECT PTN_NO FROM SUB_PORT_REQUEST WHERE REQUEST_NO = A.REQUEST_NO AND ROWNUM=1)AS PTN_NO FROM ORDER_PORT_REQUEST A, PORT_REQUEST B, PORT_STATUS C, ENS_EXT_ORDER_MAP D WHERE A.REQUEST_NO = B.REQUEST_NO AND C.STATUS_CODE = B.REQUEST_STS AND C.PORT_TYPE = B.PORT_PATH AND A.ORDER_OID = D.ENS_ORDER_OID AND D.EXT_ORDER_OID = ?
order.getOrderLineSIMandIMEIDetails=SELECT B.ORDER_ID, B.LINE_ID, B.SUBSCRIBER_ID, B.WIRELESS_NUMBER,C.SIM, C.IMEI FROM ZIG_LINEITEM_INFO B, zig_order_shipment_info C WHERE B.ORDER_ID = C.ORDER_ID AND B.LINE_ID = C.LINE_ITEM_NO AND B.ORDER_ID = ? AND C.PRODUCT_TYPE IN ('device','sim')
order.getCurrentStatus=SELECT STATUS_CODE FROM ZIG_AUTO_MASTER WHERE ORDER_ID = ?
order.getCurrentSIMValue=SELECT SIM FROM ZIG_ORDER_SHIPMENT_INFO where product_type in ('device','sim') and order_id=? and LINE_ITEM_NO =?
order.getCurrentIMEIValue=SELECT IMEI FROM ZIG_ORDER_SHIPMENT_INFO where product_type='device' and order_id=? and LINE_ITEM_NO =?
order.getCurrentRetryCount=SELECT RETRY FROM ZIG_AUTO_MASTER WHERE ORDER_ID = ?

## Dashboard Page
order.stuckOrdersCount=select status_code ,count(status_code) as count from zig_auto_master where sys_creation_date>sysdate-100 and status_code in ('OSHF','ORFI','ACTF','ORLF','OURF','PDRF','PTRF') group by status_code
order.stuckOrdersbyStatus=select order_id from zig_auto_master where sys_creation_date>sysdate-100 and status_code=?
order.handled=SELECT SYS_CREATION_DATE, COUNT(ORDER_ID) FROM (SELECT TO_CHAR(SYS_CREATION_DATE,'DD MON') AS SYS_CREATION_DATE, ORDER_ID FROM PSO_ORDER_TRACKER WHERE SYS_CREATION_DATE>SYSDATE-10 ) GROUP BY SYS_CREATION_DATE order by SYS_CREATION_DATE
order.stuckOrdersStatusbyCount=select status_code,count(status_code) as count from zig_auto_master where sys_creation_date>sysdate-100 and status_code in ('OSHF','ORFI','ACTF','ORLF','OURF','PDRF','PRTF') group by status_code
order.stuckOrderBacklogInLast10Days=SELECT CREATION_DATE,STATUS_CODE,ORDER_COUNT FROM (SELECT TO_CHAR(SYS_CREATION_DATE,'DD Mon YYYY')AS CREATION_DATE,STATUS_CODE,COUNT(ORDER_ID) AS ORDER_COUNT FROM (  SELECT ORDER_ID,STATUS_CODE,SYS_CREATION_DATE   FROM ZIG_AUTO_MASTER   WHERE SYS_CREATION_DATE > SYSDATE-10  )GROUP BY TO_CHAR(SYS_CREATION_DATE,'DD Mon YYYY'),STATUS_CODE )ORDER BY TO_DATE(CREATION_DATE,'DD-MM-YYYY') DESC

## Update Order Page
order.updateOrderStatusQuerry=update ZIG_AUTO_MASTER set status_code=? where order_id=?
order.updateOrderIMEIQuerry=update ZIG_ORDER_SHIPMENT_INFO set IMEI=? where product_type='device' and order_id=? and LINE_ITEM_NO = ?
order.updateOrderSIMQuerry=update ZIG_ORDER_SHIPMENT_INFO set SIM=? where product_type in ('device','sim') and order_id=? and LINE_ITEM_NO = ?
order.updateOrderRetryCountQuerry=update ZIG_AUTO_MASTER set retry=? where order_id=?
order.updateOrderTrackerQuerry=insert into PSO_ORDER_TRACKER(TID,ORDER_ID,UPDATE_TYPE,CURRENT_VALUE,NEW_VALUE,SYS_CREATION_DATE,LOG_REF_ID,UPDATE_BY,UPDATED_TABLE,SYS_UPDATE_DATE) values (PSO_ORDER_TRACKER_SEQ.nextval,?,?,?,?,sysdate,?,?,?,sysdate)
order.createTempTableForBulkUpdate=CREATE TABLE <TABLE_NAME>(ORDER_ID VARCHAR2(40 CHAR),LINE_ID NUMBER(19),STATUS VARCHAR2(10),SIM VARCHAR2(50), IMEI VARCHAR2(50), RETRY NUMBER(1),CREATED_BY VARCHAR2(50),SYS_CREATION_DATE TIMESTAMP(6))
order.insertBulkOrderInTempTable=INSERT INTO <TABLE_NAME>(ORDER_ID,LINE_ID ,STATUS ,SIM , IMEI, RETRY ,CREATED_BY ,SYS_CREATION_DATE) VALUES(?,?,?,?,?,?,?,SYSDATE)
order.readTempTableforBulkOrder=SELECT ORDER_ID,LINE_ID ,STATUS ,SIM , IMEI, RETRY ,CREATED_BY ,SYS_CREATION_DATE FROM <TABLE_NAME>


